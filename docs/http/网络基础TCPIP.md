---
sidebarDepth: 2
---
# 网络基础TCP/IP

通常使用的网络（包括互联网）是在`TCP/IP`协议族的基础上运作的。而`HTTP`属于它内部的一个子集。

## TCP/IP协议族

### 定义

计算机与网络设备要相互通信，双方就必须基于相同的方法。

比如，如何探测到通信目标、由那一边先发起通信、使用哪种语言进行通信、怎样结束通信等规则都需要事先确定。不同的硬件、操作系统之间的通信，所有的这一切都需要一种规则。

而我们就把这种规则称为协议（`protocol`）。

协议中存在各式各样的内容。从电缆的规格到`IP`地址的选定方法、寻找异地用户的方法、双方建立通信的顺序，以及WEB页面显示需要处理的步骤，等等。

像这样把与互联网相关联的协议集合起来总称为`TCP/IP`。

### TCP/IP的分层管理

`TCP/IP`协议族里重要的一点就是分层。

`TCP/IP`协议族按层次分别分为以下4层：

- 应用层

  应用层决定了向用户提供应用服务是通信的活动。

  协议有：`FTP`、`DNS`、`HTTP`。

- 传输层

  传输层对上层应用层，提供处于网络连接中的两台计算机之间的数据传输。

  在传输层有两个不同的协议：`TCP`（传输控制协议）和`UDP`（用户数据报协议）

- 网络层

  网络层用来处理在网络上流动的数据包。

  数据包是网络传输的最小数据单位。

  该层规定了通过怎样的路径（传输路线）到达对方计算机，并把数据包传送给对方。

  协议有：`IP`。

- 链路层（又名网络接口层）

  用来处理连接网络的硬件部分。

  包括控制操作系统、硬件的设备驱动、网卡，及光纤等。

把`TCP/IP`层次化是有好处的。

比如，如果互联网只由一个协议统筹，某个地方需要改变设计时，就必须把所部分整体替换掉。

而分层之后只需把变动的层替换掉即可。

### TCP/IP通信传输流

利用`TCP/IP`协议族进行网络通信时，会通过分层与对方进行通信。发送端从应用从往下走，接收端则往应用层往上走。

用`HTTP`举例：

首先作为发送端的客户端在应用层（`HTTP`协议）发出一个想看某个`web`页面的`HTTP`请求。

接着，为了传输方便，在传输层（`TCP`协议）把应用层处收到的数据（`HTTP`请求报文）进行分割，并在各个报文上打上标记序号及端口号后发给网络层。

在网络层（`IP`协议），增加作为通信目的地的MAC地址后转发给链路层。

这样一来，发往网络的通信请求就准备齐全了。

接收端的服务器在链路层接收到数据，按序往上层发送，一直到应用层。当传输到应用层，才能算真正接收到由客户端发送过来的`HTTP`请求。

发送端在层与层之间传输数据时，每经过一层时必定会被打上一个该层所属的首部信息。反之，接收端在层与层传输数据时，每经过一层时会吧对应的首部消去。

这种把数据信息包装起来的做法称为封装。

## 与HTTP关系密切的协议：IP、TCP和DNS

### 负责传输的IP协议

`IP`（`Internet Protocol`）网际协议位于网络层。

`IP`协议的作用是把各种数据包传送给对方。而要保证确实传送到对方那里，则需要满足各类条件。其中两个重要的条件是`IP`地址和`MAC`地址。

`IP`地址指明了节点被分配的地址，`MAC`地址是指网卡所属的固定地址。

`IP`地址可以和`MAC`地址进行配对。`IP`地址可以变换，但`MAC`地址基本上不会变。

#### 使用ARP协议凭借MAC地址进行通信

`IP`间的通信依赖`MAC`地址。在网络上，通信的双方在同一局域网内的情况是很少的，通常是多台计算机和网络设备中转才能连接到对方。而在进行中转时，会利用下一站中转设备的`MAC`地址来搜索下一个中转目标。这时候，会采用`ARP`协议。`ARP`协议是一种用以解析地址的协议，根据通信方的`IP`地址就可以反查出对应得`MAC`地址。

在到达通信目标前的中转过程中，那些计算机和路由器等网络设备只能获悉很粗略的传输路线。

这种机制为路由选择。

### 确保可靠性的TCP协议

`TCP`位于传输层，提供可靠的字节流服务。

所谓的字节流服务是指，为了方便传输，将大块数据分割成以报文段为单位的数据包进行管理。

而可靠的传输服务是指，能够把数据准确可靠的传个对方。

#### 确保数据能到达目标

为了准确无误的将数据送到目标，`TCP`协议采用了三次握手策略。

用`TCP`协议把数据包送出去后，`TCP`不会对传送后的情况置之不理，它一定会向对方确认是否成功送达。握手过程中使用`TCP`的标志（`flag`）——`SYN`和`ACK`。

发送端首先发送一个带`SYN`标志的数据包给对方。接收端收到后，回传一个带有`SYN/ACK`标志的数据包以示传达确认信息。最后，发送端再回传一个`ACK`标志的数据包，代表握手结束。

若在握手过程中某个阶段莫名中断，`TCP`协议会再次以相同的顺序发送相同的数据包。

#### 负责域名解析的DNS服务

`DNS`服务是和`HTTP`协议一样位于应用层的协议。它提供域名到`IP`地址之间的解析服务。

计算机即可以被赋予`IP`地址，也可以被赋予主机名和与域名。

用户通常使用主机名或域名来访问对方的计算机，而不是直接通过`IP`地址访问。

但要让计算机去理解名称，相对而言就变得困难了。为了解决上述的问题，`DNS`服务应运而生。`DNS`协议提供通过域名查找`IP`地址，或逆向从`IP`地址反查域名的服务。



